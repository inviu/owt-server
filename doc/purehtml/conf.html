<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Intel&reg; Collaboration Suite for WebRTC: Open WebRTC Toolkit(OWT) Server User Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="intel_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Intel&reg; Collaboration Suite for WebRTC
   &#160;<span id="projectnumber">version&nbsp;4.3</span>
   </div>
   <div id="projectbrief">Open WebRTC Toolkit(OWT) Server User Guide</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Open WebRTC Toolkit(OWT) Server User Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="Conferencesection1"></a>
1 Overview</h1>
<h2><a class="anchor" id="Conferencesection1_1"></a>
1.1 Introduction</h2>
<p>Welcome to the Open WebRTC Toolkit Server User Guide. This guide describes how to install and configure the Open WebRTC Toolkit Server for multi-party conferences and so on. This guide also explains how to install and launch the Peer Server for peer-to-peer communications.</p>
<p>Open WebRTC Toolkit Server provides an efficient WebRTC-based video conference service that scales a single WebRTC stream out to many endpoints. The following list briefly explains the purpose of each section in this guide:</p>
<ul>
<li>Section 1. Introduction and conventions used in this guide.</li>
<li>Section 2. Installing and configuring the OWT server.</li>
<li>Section 3. Brief guide of OWT server manangement console.</li>
<li>Section 4. Installing the OWT sample application server.</li>
<li>Section 5. Installing and launching the Peer Server.</li>
</ul>
<p>Installation requirements and dependencies for the OWT server, sample application server, and peer server are described in their associated sections.</p>
<h2><a class="anchor" id="Conferencesection1_2"></a>
1.2 Terminology</h2>
<p>This manual uses the following acronyms and terms:</p>
<table class="doxtable">
<tr>
<th>Abbreviation </th><th>Full Name  </th></tr>
<tr>
<td>ADT</td><td>Android Developer Toolkit </td></tr>
<tr>
<td>API</td><td>Application Programming Interface </td></tr>
<tr>
<td>GPU</td><td>Graphics Processing Unit </td></tr>
<tr>
<td>IDE</td><td>Integrated Development Environment </td></tr>
<tr>
<td>JS</td><td>JavaScript programming language </td></tr>
<tr>
<td>MCU</td><td>Multipoint Control Unit </td></tr>
<tr>
<td>MSML</td><td>Media Server Markup Language </td></tr>
<tr>
<td>P2P</td><td>Peer-to-Peer </td></tr>
<tr>
<td>QoS</td><td>Quality of Service </td></tr>
<tr>
<td>ReST</td><td>Representational State Transfer </td></tr>
<tr>
<td>RTC</td><td>Real-Time Communication </td></tr>
<tr>
<td>RTCP</td><td>RTP Control Protocol </td></tr>
<tr>
<td>RTSP</td><td>Real Time Streaming Protocol </td></tr>
<tr>
<td>RTMP</td><td>Real Time Messaging Protocol </td></tr>
<tr>
<td>RTP</td><td>Real Time Transport Protocol </td></tr>
<tr>
<td>SDK</td><td>Software Development Kit </td></tr>
<tr>
<td>SDP</td><td>Session Description Protocol </td></tr>
<tr>
<td>SIP</td><td>Session Initiation Protocol </td></tr>
<tr>
<td>XMPP</td><td>Extensible Messaging and Presence Protocol </td></tr>
<tr>
<td>WebRTC</td><td>Web Real-Time Communication </td></tr>
</table>
<h2><a class="anchor" id="Conferencesection1_3"></a>
1.3 For more information</h2>
<p>For more information, visit the following Web pages:</p>
<ul>
<li>Intel HTML Developer Zone: <a href="https://software.intel.com/en-us/html5/tools">https://software.intel.com/en-us/html5/tools</a></li>
<li>Intel<sup>®</sup> Collaboration Suite for WebRTC<ol type="1">
<li><a href="http://webrtc.intel.com">http://webrtc.intel.com</a></li>
<li><a href="https://software.intel.com/en-us/forums/webrtc">https://software.intel.com/en-us/forums/webrtc</a></li>
<li><a href="https://software.intel.com/zh-cn/forums/webrtc">https://software.intel.com/zh-cn/forums/webrtc</a></li>
</ol>
</li>
<li>Intel<sup>®</sup> Visual Compute Accelerator<ol type="1">
<li><a href="https://www.intel.com/content/www/us/en/servers/media-and-graphics/visual-compute-accelerator.html">https://www.intel.com/content/www/us/en/servers/media-and-graphics/visual-compute-accelerator.html</a></li>
<li><a href="https://www-ssl.intel.com/content/www/us/en/cloud-computing/visual-cloud.html">https://www-ssl.intel.com/content/www/us/en/cloud-computing/visual-cloud.html</a></li>
</ol>
</li>
<li>The Internet Engineering Task Force (IETF<sup>®</sup>) Working Group<ol type="1">
<li><a href="https://tools.ietf.org/wg/rtcweb/">https://tools.ietf.org/wg/rtcweb/</a></li>
</ol>
</li>
<li>W3C WebRTC Working Group: <a href="http://www.w3.org/2011/04/webrtc/">http://www.w3.org/2011/04/webrtc/</a></li>
<li>WebRTC Open Project: <a href="http://www.webrtc.org">http://www.webrtc.org</a></li>
</ul>
<h1><a class="anchor" id="Conferencesection2"></a>
2 OWT Server Installation</h1>
<h2><a class="anchor" id="Conferencesection2_1"></a>
2.1 Introduction</h2>
<p>This section describes the system requirements for installing the OWT server, and the compatibility with its client.</p>
<blockquote class="doxtable">
<p><b>Note</b>: Installation requirements for the peer server are described in <a href="#Conferencesection5">section 5</a> of this guide. </p>
</blockquote>
<h2><a class="anchor" id="Conferencesection2_2"></a>
2.2 Requirements and compatibility</h2>
<p>Table 2-1 describes the system requirements for installing the OWT server. Table 2-2 gives an overview of OWT server compatibility with the client.</p>
<p><b>Table 2-1. Server requirements</b> </p><table class="doxtable">
<tr>
<th>Application name</th><th>OS version  </th></tr>
<tr>
<td>OWT server</td><td>CentOS* 7.6, Ubuntu 18.04 LTS </td></tr>
</table>
<p>The GPU-acceleration can only be enabled on kernel 4.14 or later (4.19 or later is recommended).</p>
<p>If you want to set up video conference service with H.264 codec support powered by non GPU-accelerated OWT server, OpenH264 library is required. See <a href="#Conferencesection2_3_4">Deploy Cisco OpenH264* Library</a> section for more details.</p>
<p>If you want to set up video conference service with SVT-HEVC Encoder on Ubuntu 18.04 LTS. See <a href="#Conferencesection2_3_6">Deploy SVT-HEVC Encoder Library</a> section for more details.</p>
<p>If you want to set up video conference service powered by GPU-accelerated OWT server through Intel® Media SDK, please follow the below instructions to install server side SDK where the video-agents run.</p>
<p>If you are working on the following platforms with the integrated graphics, please install Intel® Media SDK. The current release is fully tested on MediaSDK 2018 Q4(<a href="https://github.com/Intel-Media-SDK/MediaSDK/releases/tag/intel-mediasdk-18.4.0">https://github.com/Intel-Media-SDK/MediaSDK/releases/tag/intel-mediasdk-18.4.0</a>).</p>
<ul>
<li>Intel® Xeon® E3-1200 v4 Family with C226 chipset</li>
<li>Intel® Xeon® E3-1200 and E3-1500 v5 Family with C236 chipset</li>
<li>5th Generation Intel® CoreTM</li>
<li>6th Generation Intel® CoreTM</li>
<li>7th Generation Intel® CoreTM</li>
</ul>
<p>For download or installation instructions, please visit <a href="https://github.com/Intel-Media-SDK/MediaSDK">https://github.com/Intel-Media-SDK/MediaSDK</a>.</p>
<p>The external stream output and mp4 format recording rely on AAC encoder libfdk_aac support in ffmpeg library, please see <a href="#Conferencesection2_3_5">Compile and deploy ffmpeg with libfdk_aac</a> section for detailed instructions.</p>
<p><b>Table 2-2. Client compatibility</b> </p><table class="doxtable">
<tr>
<th>Application Name</th><th>Google Chrome* 78</th><th>Mozilla Firefox* 70</th><th>Microsoft Edge* 44.18362.387.0</th><th>Safari* 13.0</th><th>Open WebRTC Toolkit Client SDK for Android </th><th>Open WebRTC Toolkit Client SDK for iOS </th><th>Open WebRTC Toolkit Client SDK for Windows  </th></tr>
<tr>
<td>OWT Client</td><td>YES</td><td>YES</td><td>YES</td><td>YES</td><td>YES</td><td>YES</td><td>YES </td></tr>
<tr>
<td>Management Console</td><td>YES</td><td>YES</td><td>YES</td><td>YES</td><td>N/A</td><td>N/A</td><td>N/A </td></tr>
</table>
<h2><a class="anchor" id="Conferencesection2_3"></a>
2.3 Install the OWT server</h2>
<p>This section describes the dependencies and steps for installing the OWT server. </p>
<h3><a class="anchor" id="Conferencesection2_3_1"></a>
2.3.1 Dependencies</h3>
<p><b>Table 2-3. OWT Server Dependencies</b> </p><table class="doxtable">
<tr>
<th>Name</th><th>Version</th><th>Remarks  </th></tr>
<tr>
<td>Node.js </td><td>8.15.0</td><td>Website: <a href="http://nodejs.org/">http://nodejs.org/</a> </td></tr>
<tr>
<td>Node modules</td><td>Specified</td><td>N/A </td></tr>
<tr>
<td>MongoDB</td><td>2.6.10 </td><td>Website: <a href="http://mongodb.org">http://mongodb.org</a> </td></tr>
<tr>
<td>System libraries</td><td>Latest</td><td>N/A </td></tr>
</table>
<p>All dependencies, except system libraries, are provided or can be automatically installed with the release package.</p>
<p>All essential system libraries are installed when you install the OWT server package using the Ubuntu or CentOS's package management system.</p>
<p>Regarding Node.js*, make sure it's installed in your system prior to installing the OWT server. We recommend version 8.15.0. Refer to <a href="http://nodejs.org/">http://nodejs.org/</a> for the details and installation.</p>
<p>Before installing the OWT server, make sure your login account has sys-admin privileges; i.e. the ability to execute <code>sudo</code>.</p>
<h3><a class="anchor" id="Conferencesection2_3_2"></a>
2.3.2 Configure the OWT server machine</h3>
<p>If you run OWT server on CentOS, configure the system firewall well to make sure all ports required by OWT server components are open.</p>
<h3><a class="anchor" id="Conferencesection2_3_3"></a>
2.3.3 Install the OWT server package</h3>
<p>On the server machine, directly unarchive the package file.</p>
<div class="fragment"><div class="line">tar xf CS_WebRTC_Conference_Server_MCU.v&lt;Version&gt;.CentOS.tgz</div></div><!-- fragment --><p>For Ubuntu version OWT server, do as following:</p>
<div class="fragment"><div class="line">tar xf CS_WebRTC_Conference_Server_MCU.v&lt;Version&gt;.Ubuntu.tgz</div></div><!-- fragment --><h3><a class="anchor" id="Conferencesection2_3_4"></a>
2.3.4 Deploy Cisco OpenH264* Library</h3>
<p>The default H.264 library installed is a pseudo one without any media logic. To enable H.264 support in non GPU-accelerated OWT server system, you must deploy the Cisco OpenH264 library. Choose yes to download and enable Cisco Open H264 library during video-agent dependency installation at Release-&lt;Version&gt;/[video_agent/analytics_agent]/install_deps.sh.</p>
<p>Or you can also use install_openh264.sh or uninstall_openh264.sh scripts under Release-&lt;Version&gt;/video_agent folder to enable or disable Cisco OpenH264 library later.</p>
<h3><a class="anchor" id="Conferencesection2_3_5"></a>
2.3.5 Compile and deploy ffmpeg with libfdk_aac</h3>
<p>The default ffmpeg library used by OWT server has no libfdk_aac support. If you want to enable libfdk_aac for external stream output or mp4 format recording, please compile and deploy ffmpeg yourself with following steps:</p>
<blockquote class="doxtable">
<p><b>Note</b>: The libfdk_aac is designated as "non-free", please make sure you have got proper authority before using it. </p>
</blockquote>
<ol type="1">
<li>Go to Release-&lt;Version&gt;/audio_agent folder, compile ffmpeg with libfdk_aac with below command: <pre class="fragment"> compile_ffmpeg_with_libfdkaac.sh
</pre> <blockquote class="doxtable">
<p><b>Note</b>: This compiling script will install all dependencies for ffmpeg with libfdk_aac. If those dependencies are not expected on deployment machines, please run the script on other proper machine. </p>
</blockquote>
</li>
<li>Copy all output libraries under ffmpeg_libfdkaac_lib folder to Release-&lt;Version&gt;/audio_agent/lib to replace the existing ones.</li>
</ol>
<h3><a class="anchor" id="Conferencesection2_3_6"></a>
2.3.6 Deploy SVT-HEVC Encoder Library</h3>
<p>The default SVT-HEVC Encoder library installed is a pseudo one without any media logic. If you want to enable SVT-HEVC Encoder, please compile and deploy the library yourself with following steps:</p>
<ol type="1">
<li>Go to Release-&lt;Version&gt;/video_agent folder, compile SVT-HEVC Encoder library with below command: <pre class="fragment"> compile_svtHevcEncoder.sh
</pre></li>
<li>Copy the built library(libSvtHevcEnc.so.1) to Release-&lt;Version&gt;/video_agent/lib to replace the existing one.</li>
</ol>
<h3><a class="anchor" id="Conferencesection2_3_7"></a>
2.3.7 Use your own certificate</h3>
<p>The default certificate (certificate.pfx) for the OWT server is located in the Release-&lt;Version&gt;/&lt;Component&gt;/cert folder. When using HTTPS and/or secure socket.io connection, you should use your own certificate for each server. First, you should edit management_api/management_api.toml, webrtc_agent/agent.toml, portal/portal.toml, management_console/management_console.toml to provide the path of each certificate for each server, under the key keystorePath. See Table 2-4 for details.</p>
<p>We use PFX formatted certificates in OWT server. See <a href="https://nodejs.org/api/tls.html">https://nodejs.org/api/tls.html</a> for how to generate a self-signed certificate by openssl utility. We recommend using 2048-bit private key for the certificates. But if you meet DTLS SSL connection error in webrtc-agent, please use 1024-bit instead of 2048-bit private key because of a known network MTU issue.</p>
<p>After editing the configuration file, you should run <code>./initcert.js</code> inside each component to input your passphrases for the certificates, which would then store them in an encrypted file. Be aware that you should have node binary in your shell's $PATH to run the JS script.</p>
<p><b>Table 2-4. OWT server certificates configuration</b> </p><table class="doxtable">
<tr>
<th></th><th>configuration file  </th></tr>
<tr>
<td>management-api HTTPS </td><td>management_api/management_api.toml </td></tr>
<tr>
<td>portal secured Socket.io </td><td>portal/portal.toml </td></tr>
<tr>
<td>DTLS-SRTP </td><td>webrtc_agent/agent.toml </td></tr>
<tr>
<td>management-console HTTPS </td><td>management_console/management_console.toml </td></tr>
</table>
<p>For OWT sample application's certificate configuration, please follow the instruction file 'README.md' located at Release-&lt;Version&gt;/extras/basic_example/.</p>
<h3><a class="anchor" id="Conferencesection2_3_8"></a>
2.3.8 Launch the OWT server as single node</h3>
<p>To launch the OWT server on one machine, follow steps below:</p>
<ol type="1">
<li><p class="startli">Initialize the OWT package for the first time execution.</p>
<p class="startli">For general OWT Server installation, use following command: </p><pre class="fragment">bin/init-all.sh [--deps]
</pre><p class="startli">If you want to enable GPU-acceleration through Intel Media Server Studio, use following command: </p><pre class="fragment">bin/init-all.sh [--deps] --hardware
</pre> <blockquote class="doxtable">
<p><b>Note</b>: If you have already installed the required system libraries, then &ndash;deps is not required. If you have installed early version of OWT server, the stored data will not be compatible with 4.1 version. Pay attention to the warning and choose option to update your OWT data in mongodb. </p>
</blockquote>
</li>
<li>Run the following commands to start the OWT server: <pre class="fragment"> cd Release-&lt;Version&gt;/
 bin/start-all.sh
</pre> <blockquote class="doxtable">
<p><b>Note</b>: If you want to run start-all in a combined command like "ssh remote-host OWT-server-installed-path/bin/start-all", the environment $DISPLAY needs to be explicitly specified as "export DISPLAY=:0.0". </p>
</blockquote>
</li>
<li>To verify whether the server has started successfully, launch your browser and connect to the OWT server at <a href="https://XXXXX:3004">https://XXXXX:3004</a>. Replace XXXXX with the IP address or machine name of your OWT server.</li>
</ol>
<blockquote class="doxtable">
<p><b>Note</b>: The procedures in this guide use the default room in the sample. </p>
</blockquote>
<h3><a class="anchor" id="Conferencesection2_3_9"></a>
2.3.9 Stop the OWT server</h3>
<p>Run the following commands to stop the OWT server: </p><pre class="fragment">cd Release-&lt;Version&gt;/
bin/stop-all.sh
</pre><h3><a class="anchor" id="Conferencesection2_3_10"></a>
2.3.10 Set up the OWT server cluster</h3>
<p><b>Table 2-5. Distributed OWT server components</b> </p><table class="doxtable">
<tr>
<th>Component Name</th><th>Deployment Number</th><th>Responsibility  </th></tr>
<tr>
<td>management-api</td><td>1 or many</td><td>The entrance of OWT service, keeping the configurations of all rooms, generating and verifying the tokens. Application can implement load balancing strategy across multiple management-api instances </td></tr>
<tr>
<td>cluster-manager</td><td>1 or many</td><td>The manager of all active workers in the cluster, checking their lives, scheduling workers with the specified purposes according to the configured policies. If one has been elected as master, it will provide service; others will be standby </td></tr>
<tr>
<td>portal</td><td>1 or many</td><td>The signaling server, handling service requests from Socket.IO clients </td></tr>
<tr>
<td>conference-agent</td><td>1 or many</td><td>This agent handles room controller logics </td></tr>
<tr>
<td>webrtc-agent</td><td>1 or many</td><td>This agent spawning webrtc accessing nodes which establish peer-connections with webrtc clients, receive media streams from and send media streams to webrtc clients </td></tr>
<tr>
<td>streaming-agent</td><td>0 or many</td><td>This agent spawning streaming accessing nodes which pull external streams from sources and push streams to rtmp/rtsp destinations </td></tr>
<tr>
<td>recording-agent</td><td>0 or many</td><td>This agent spawning recording nodes which record the specified audio/video streams to permanent storage facilities </td></tr>
<tr>
<td>audio-agent</td><td>1 or many</td><td>This agent spawning audio processing nodes which perform audio transcoding and mixing </td></tr>
<tr>
<td>video-agent</td><td>1 or many</td><td>This agent spawning video processing nodes which perform video transcoding and mixing </td></tr>
<tr>
<td>analytics-agent</td><td>0 or many</td><td>This agent spawning media analyzing nodes which perform media analytics </td></tr>
<tr>
<td>sip-agent</td><td>0 or many</td><td>This agent spawning sip processing nodes which handle sip connections </td></tr>
<tr>
<td>sip-portal</td><td>0 or 1</td><td>The portal for initializing rooms' sip settings and scheduling sip agents to serve for them </td></tr>
<tr>
<td>app</td><td>0 or 1</td><td>The sample web application for reference, users should use their own application server </td></tr>
<tr>
<td>management-console</td><td>0 or 1</td><td>The console for conference management </td></tr>
</table>
<p>Follow the steps below to set up a OWT server cluster:</p>
<ol type="1">
<li>Make sure you have installed the OWT server package on each machine before launching the cluster which has been described in section <a href="#Conferencesection2_3_3">Install the OWT server package</a>.</li>
<li><p class="startli">Choose machines to initialize MongoDB and RabbitMQ servers.</p>
<p class="startli">For MongoDB, do as following: </p><pre class="fragment">cd Release-&lt;Version&gt;/
bin/init-mongodb.sh [--deps]
</pre><p class="startli">For RabbitMQ, do as following: </p><pre class="fragment">cd Release-&lt;Version&gt;/
bin/init-rabbitmq.sh [--deps]
</pre> <blockquote class="doxtable">
<p><b>Note</b>: You can change the shell scripts to initialize them according to your own requirement. Or choose any other existing MongoDB or RabbitMQ service, like those with cluster support. Make sure MongoDB and RabbitMQ services are started prior to all OWT server cluster nodes. </p>
</blockquote>
<pre class="fragment">If non-default user of rabbitmq-server or mongodb-server is used, do as following in each module:

    initauth.js
</pre></li>
<li>Choose machines to run management-api instances. These machines must be visible to clients(such as browsers and mobile apps).</li>
<li>Edit the configuration items of management-api in Release-&lt;Version&gt;/management_api/management_api.toml.<ul>
<li>Make sure the [mongo.dataBaseURL] points to the MongoDB instance.</li>
<li>Make sure the [rabbit.port] and [rabbit.host] point to the RabbitMQ server.</li>
</ul>
</li>
<li><p class="startli">Initialize and run management-api instance on each machine with following steps.</p>
<p class="startli">1) Initialize OWT server manager management-api for the first time execution: </p><pre class="fragment">cd Release-&lt;Version&gt;/
management_api/init.sh
</pre><p class="startli"><b>Note</b>: If you have installed early version of OWT server, the stored data will not be compatible with 4.0 version. Pay attention to the warning and choose option to update your OWT server data in mongodb.</p>
<p class="startli">2) Run OWT server manager management-api and the sample application with following commands: </p><pre class="fragment">cd Release-&lt;Version&gt;/
bin/daemon.sh start management-api
</pre></li>
<li>Choose any management-api instance machine to run the sample application server for quick OWT service validation. <pre class="fragment"> cd Release-&lt;Version&gt;/
 bin/daemon.sh start app
</pre> <blockquote class="doxtable">
<p><b>Note</b>: You can also deploy the sample application server on separated machine, follow instructions at Release-&lt;Version&gt;/extras/basic_example/README.md </p>
</blockquote>
</li>
<li>Choose machines to run cluster-managers. These machines do not need to be visible to clients, but should be visible to management-api and all workers.</li>
<li>Edit the configurations of cluster-manager in Release-&lt;Version&gt;/cluster_manager/cluster_manager.toml.<ul>
<li>Make sure the [rabbit.port] and [rabbit.host] point to the RabbitMQ server.</li>
</ul>
</li>
<li>Run the cluster-manager on each machine with following commands: <pre class="fragment"> cd Release-&lt;Version&gt;/
 bin/daemon.sh start cluster-manager
</pre></li>
<li>Choose worker machines to run portals. These machines must be visible to clients.</li>
<li>Edit the configuration items of portal in Release-&lt;Version&gt;/portal/portal.toml.<ul>
<li>Make sure the [mongo.dataBaseURL] points to the MongoDB instance.</li>
<li>Make sure the [rabbit.port] and [rabbit.host] point to the RabbitMQ server.</li>
<li>Make sure the [portal.ip_address] or [portal.networkInterface] points to the correct network interface which the clients’ signaling and control messages are expected to connect through.</li>
<li>Make sure the [portal.force_tls_v12] is true if you want to force TLS version not less than 1.2.</li>
</ul>
</li>
<li>Run the portal on each machine with following commands: <pre class="fragment">cd Release-&lt;Version&gt;/
bin/daemon.sh start portal
</pre></li>
<li>Choose a worker machine to run conference-agent and/or webrtc-agent and/or streaming-agent and/or recording-agent and/or audio-agent and/or video-agent and/or sip-agent. This machine must be visible to other agent machines. If webrtc-agent or sip-agent is running on it, it must be visible to clients.<ul>
<li>If you want to use Intel<sup>®</sup> Visual Compute Accelerator (VCA) to run video agents, please follow section <a href="#Conferencesection2_3_11">Configure VCA nodes</a> to enable nodes of Intel VCA as a visible separated machine.</li>
</ul>
</li>
<li><p class="startli">Edit the configuration items in Release-&lt;Version&gt;/{audio, video, conference, webrtc, streaming, recording, sip}_agent/agent.toml.</p><ul>
<li>Make sure the [rabbit.port] and [rabbit.host] point to the RabbitMQ server.</li>
<li>Make sure the [cluster.ip_address] or [cluster.network_interface] points to the correct network interface through which the media streams will flow to other cluster nodes.</li>
</ul>
<p class="startli">Special for conference-agent, edit conference_agent/agent.toml</p><ul>
<li>Make sure the [mongo.dataBaseURL] points to the MongoDB instance.</li>
</ul>
</li>
<li><p class="startli">Initialize and run agent worker.</p>
<p class="startli">1) Initialize agent workers for the first time execution if necessary</p>
<p class="startli">For each agent, follow these steps: </p><pre class="fragment"> cd Release-&lt;Version&gt;/
 [video_agent/audio_agent/webrtc_agent/recording_agent/streaming_agent/sip_agent/analytics_agent]/install_deps.sh
</pre><p class="startli">If you want to enable GPU-acceleration for video-agent through Media Server Studio, follow these steps: </p><pre class="fragment"> cd Release-&lt;Version&gt;/
 video_agent/install_deps.sh --hardware
 video_agent/init.sh --hardware
</pre><p class="startli">2) Run the following commands to launch agent worker: </p><pre class="fragment">cd Release-&lt;Version&gt;/
bin/daemon.sh start [conference-agent/webrtc-agent/streaming-agent/audio-agent/video-agent/analytics-agent/recording-agent/sip-agent]
</pre></li>
<li>Repeat step 13 to 15 to launch as many OWT server agent worker machines as you need.</li>
<li>Choose one worker machine to run sip-portal if sip-agent workers are deployed: <pre class="fragment">cd Release-&lt;Version&gt;/
bin/daemon.sh start sip-portal
</pre></li>
<li>Choose one worker machine to run management-console if you need to create/update/delete services and rooms on web page.: <pre class="fragment">cd Release-&lt;Version&gt;/
bin/daemon.sh start management-console
</pre></li>
</ol>
<h3><a class="anchor" id="Conferencesection2_3_11"></a>
2.3.11 Configure VCA nodes as seperated machines to run video-agent</h3>
<p>To setup VCA nodes as separate machines, two approaches are provided. One is the network bridging provided by VCA software stack. The other is IP forwarding rules setting through iptables.</p>
<p>VCA built-in software stack provides network bridging support. Follow section 4.4.1 - Configuring nodes for bridged mode operation in VCA_SoftwareUserGuide.pdf. In this approach, all network traffic will go through one Ethernet interface.</p>
<p>If you want to map each VCA node to different Ethernet interface, IP forwarding can be one alternative to achieve this goal. Follow these steps:</p><ol type="1">
<li>Make sure one VCA card is correctly installed and VCA nodes successfully boot up.</li>
<li>Make sure the host machine has enough ethernet interface for VCA nodes. Eg: host IP is "10.239.44.100" and 3 ethernet interfaces for 3 nodes of 1 VCA card, and the IP of ethernet Interfaces are "10.239.44.1", "10.239.44.2", "10.239.44.3".</li>
<li>Make sure your ip routing tables(please get it with "route -n") on host machine are like below : <pre class="fragment"> Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
 0.0.0.0         10.239.44.241   0.0.0.0         UG    100    0        0 enp132s0f0
 10.239.27.228   10.239.44.241   255.255.255.255 UGH   100    0        0 enp132s0f0
 10.239.44.0     0.0.0.0         255.255.255.0   U     0      0        0 enp132s0f0
 172.31.1.0      0.0.0.0         255.255.255.0   U     0      0        0 eth0
 172.31.2.0      0.0.0.0         255.255.255.0   U     0      0        0 eth2
 172.31.3.0      0.0.0.0         255.255.255.0   U     0      0        0 eth1
</pre> <blockquote class="doxtable">
<p><b>Note</b>: 10.239.27.228 is DNS server. enp132s0f0 is used for host machine and IP is "10.239.44.100". </p>
</blockquote>
</li>
<li>Please use "ifconfig" on host machine of VCA card to list IP of VCA nodes, you will get the VCA node IPs like "172.31.1.254", "172.31.2.254", "172.31.3.254".</li>
<li>Configure IP soft routing policy to set VCA Node to seperated machine.<ul>
<li>5.1 Enable ip forward and clear iptables on host machine with the following commands: <pre class="fragment">  echo "1" &gt; /proc/sys/net/ipv4/ip_forward
  iptables -t nat -P PREROUTING ACCEPT
  iptables -t nat -P POSTROUTING ACCEPT
  iptables -t nat -P OUTPUT ACCEPT
</pre></li>
<li>5.2 Enable nat policy on host for 3 VCA nodes: <pre class="fragment">  iptables -t nat -A PREROUTING -d 10.239.44.1 -j DNAT --to-destination 172.31.1.1
  iptables -t nat -A POSTROUTING -s 172.31.1.1 -j SNAT --to-source 10.239.44.1
  iptables -A OUTPUT -d 10.239.44.1 -j DNAT --to-destination 172.31.1.1
  iptables -t nat -A PREROUTING -d 10.239.44.2 -j DNAT --to-destination 172.31.2.1
  iptables -t nat -A POSTROUTING -s 172.31.2.1 -j SNAT --to-source 10.239.44.2
  iptables -A OUTPUT -d 10.239.44.2 -j DNAT --to-destination 172.31.2.1
  iptables -t nat -A PREROUTING -d 10.239.44.3 -j DNAT --to-destination 172.31.3.1
  iptables -t nat -A POSTROUTING -s 172.31.3.1 -j SNAT --to-source 10.239.44.3
  iptables -A OUTPUT -d 10.239.44.3 -j DNAT --to-destination 172.31.3.1
</pre></li>
<li>5.3 SSH to 3 seperated machines of VCA node: <pre class="fragment">  ssh root@10.239.44.1
  ssh root@10.239.44.2
  ssh root@10.239.44.3
</pre></li>
<li>5.4 Disable firewall for VCA nodes after ssh login to it: <pre class="fragment">  systemctl stop firewalld
  systemctl disable firewalld
</pre></li>
</ul>
</li>
</ol>
<h3><a class="anchor" id="Conferencesection2_3_12"></a>
2.3.12 Stop the OWT server cluster</h3>
<p>To stop the OWT server cluster, follow these steps:</p><ol type="1">
<li><p class="startli">Run the following commands on each management-api node to stop management-api instances: </p><pre class="fragment"> cd Release-&lt;Version&gt;/
 bin/daemon.sh stop management-api
</pre><p class="startli">If sample application server also runs with specific management-api instance, run the following command to stop it. </p><pre class="fragment">bin/daemon.sh stop app
</pre></li>
<li>Run the following commands on cluster manager machine to stop the cluster manager: <pre class="fragment"> cd Release-&lt;Version&gt;/
 bin/daemon.sh stop cluster-manager
</pre></li>
<li>Run the following commands on worker machines to stop cluster workers: <pre class="fragment"> cd Release-&lt;Version&gt;/
 bin/daemon.sh stop [portal/conference-agent/webrtc-agent/streaming-agent/audio-agent/video-agent/recording-agent/analytics-agent/sip-agent/sip-portal]
</pre></li>
<li>Run the following commands on management-console machine to stop the management-console: <pre class="fragment"> cd Release-&lt;Version&gt;/
 bin/daemon.sh stop management-console
</pre></li>
</ol>
<h3><a class="anchor" id="Conferencesection2_4"></a>
2.4 OWT Server cluster’s fault tolerance / resilience</h3>
<p>Open WebRTC Toolkit server provides built-in fault tolerance / resilience support for its key components, as Table 2-6 shows.</p>
<p><b>Table 2-6. OWT Server cluster components’ fault tolerance / resilience</b> </p><table class="doxtable">
<tr>
<th>Component Name</th><th>Server Reaction</th><th>Client Awareness  </th></tr>
<tr>
<td>management-api</td><td>Multiple management-api instances provide stateless services at the same time. If application implements node failure detection and rescheduling strategy, when one node fails, other nodes should take over when the further requests are assigned to any of them.</td><td>Management-API RESTful request fail </td></tr>
<tr>
<td>cluster-manager</td><td>Auto elect another cluster-manager node as master and provide service.</td><td>Transparent </td></tr>
<tr>
<td>portal</td><td>All signaling connections on this portal will be disconnected, all actions through this portal will be dropped. Client needs to re-login the session.</td><td>server-disconnected event </td></tr>
<tr>
<td>conference-agent/node</td><td>All sessions impacted will be destroyed and all their participants will be forced disconnected and all actions will be dropped. Client needs to re-login the session.</td><td>server-disconnected event </td></tr>
<tr>
<td>webrtc-agent/node</td><td>All webrtc stream actions assign to this node will be dropped. Client needs to redo these actions.</td><td>stream-failed event </td></tr>
<tr>
<td>streaming-agent/node</td><td>All external stream actions assign to this node will be dropped. Client needs to redo these actions.</td><td>stream-failed event </td></tr>
<tr>
<td>recording-agent/node</td><td>All recording stream actions assign to this node will be dropped. Client needs to redo these actions.</td><td>stream-failed event </td></tr>
<tr>
<td>audio-agent/node</td><td>Auto schedule new audio-agent/node resource to recover the session context.</td><td>Transparent </td></tr>
<tr>
<td>video-agent/node</td><td>Auto schedule new video-agent/node resource to recover the session context.</td><td>Transparent </td></tr>
<tr>
<td>analytics-agent/node</td><td>All analytics stream actions assign to this node will be dropped. Client needs to redo these actions.</td><td>stream-failed event </td></tr>
<tr>
<td>sip-agent/node</td><td>All sip participants it carries should be dropped by session nodes.</td><td>SIP BYE signaling event </td></tr>
</table>
<h2><a class="anchor" id="Conferencesection2_5"></a>
2.5 OWT Server configurations for public access</h2>
<p>Open WebRTC Toolkit server provides the following settings in configuration files to configure the network interfaces for public access.</p>
<p><b>Table 2-7. Configuration Items for Public Access</b> </p><table class="doxtable">
<tr>
<th>Configuration Item</th><th>Location</th><th>Usage  </th></tr>
<tr>
<td>webrtc.network_interfaces </td><td>webrtc_agent/agent.toml </td><td>The network interfaces of webrtc-agent that clients in public network can connect to </td></tr>
<tr>
<td>webrtc.minport </td><td>webrtc_agent/agent.toml </td><td>The webrtc port range lowerbound for clients to connect through UDP </td></tr>
<tr>
<td>webrtc.maxport </td><td>webrtc_agent/agent.toml </td><td>The webrtc port range upperbound for clients to connect through UDP </td></tr>
<tr>
<td>management-api.port </td><td>management_api/management_api.toml </td><td>The port of management-api should be accessible in public network through TCP </td></tr>
<tr>
<td>portal.hostname, portal.ip_address </td><td>portal/portal.toml </td><td>The hostname and IP address of portal for public access; hostname first if it is not empty. </td></tr>
<tr>
<td>portal.port </td><td>portal/portal.toml </td><td>The port of portal for public access through TCP </td></tr>
</table>
<h2><a class="anchor" id="Conferencesection2_6"></a>
2.6 Security Recommendations</h2>
<p>Intel Corporation does not host any conference cluster/service. Instead, the entire suite is provided so you can build your own video conference system and host your own server cluster.</p>
<p>Customers must be familiar with industry standards and best practices for deploying server clusters. Intel Corporation assumes no responsibility for loss caused from potential improper deployment and mismanagement.</p>
<p>The following instructions are provided only as recommendations regarding security best practices and by no means are they fully complete:</p>
<ol type="1">
<li>For the key pair access on OWT server, make sure only people with high enough privilege can have the clearance.</li>
<li>Regular system state audits or system change auto-detection. For example, OWT server system changes notification mechanism by third-party tool.</li>
<li>Establish policy of file based operation history for the tracking purpose.</li>
<li>Establish policy disallowing saving credentials for remote system access on OWT server.</li>
<li>Use a policy for account revocation when appropriate and regular password expire.</li>
<li>Use only per user account credentials, not account groups on OWT server.</li>
<li>Automated virus scans using approved software on OWT server.</li>
<li>Establish policy designed to ensure only allowed use of the server for external connections.</li>
<li>OWT server should install only approved software and required components, and verify default features status. For example, only enable what are needed.</li>
<li>Use a firewall and close any ports not specifically used on OWT server.</li>
<li>Run a vulnerability scan regularly for checking software updates against trusted databases, and monitor publically communicated findings and patch OWT system immediately.</li>
<li>Configure appropriate connection attempt timeouts and automated IP filtering, in order to do the rejection of unauthenticated requests.</li>
<li>If all possible, use or develop an automated health monitoring component of server service availability on OWT server.</li>
<li>Use a log analyzer solution to help detect attack attempts.</li>
<li>During server development, avoid processing of unexpected headers or query string variables, and only read those defined for the API and limit overall message size.</li>
<li>Avoid excessive error specificity and verbose details that reveal how the OWT server works.</li>
<li>During server and client development, suggest running some kind of security development lifecycle/process and conduct internal and external security testing and static code analysis with tools by trusted roles.</li>
<li>If all possible, backup all the log data to a dedicated log server with protection.</li>
<li>Deploy OWT cluster(Managers + Workers) inside Demilitarized Zone(DMZ) area, utilize external firewall A to protect them against possible attacks, e.g. DoS attack; Deploy Mongo DB and RabbitMQ behind DMZ, configure internal firewall B to make sure only cluster machines can connect to RabbitMQ server and access to MongoDB data resources.</li>
</ol>
<p><b>Figure 2-1. Security Recommendations Picture</b> </p><div class="image">
<img src="./pic/deploy.png" alt="Security Recommendations Picture"/>
</div>
<h2><a class="anchor" id="Conferencesection2_7"></a>
2.7 FAQ</h2>
<ol type="1">
<li><p class="startli">Sudden low volume when connecting Chrome on Windows to OWT server</p>
<p class="startli"><b>Resolution</b>:</p>
<p class="startli">Both the Chrome browser and Windows system itself can reduce the volume during a connection to the OWT server. To resolve this issue, disable the following Communications feature found in the Sound Settings using the Windows Control Panel.</p>
<p class="startli"><b>Figure 2-2. Sound Settings</b> </p><div class="image">
<img src="./pic/soundsettings.png" alt="Sound Settings"/>
</div>
</li>
<li><p class="startli">Failed to start OWT server, and receive the following error message: "child_process.js:948; throw errnoException(process._errno, 'spawn'); Error: spawn EMFILE"</p>
<p class="startli"><b>Resolution</b>:</p>
<p class="startli">Use the proper Node.js version as outlined in the <a href="#Conferencesection2_3_1">Dependencies</a> section.</p>
</li>
<li><p class="startli">Failed to start OWT server, and receive the following error message: "Creating superservice in localhost/management-apidb SuperService ID: Sat Feb 7 19:10:32.456 TypeError: Cannot read property '_id' of null SuperService KEY: Sat Feb  7 19:10:32.479 TypeError: Cannot read property 'key' of null"</p>
<p class="startli"><b>Resolution</b>:</p>
<p class="startli">Use the proper MongoDB version as outlined in the <a href="#Conferencesection2_3_1">Dependencies</a> section.</p>
</li>
<li><p class="startli">Run into network port conflicts on OWT server, and probably some error message like "net::ERR_CONNECTION_TIMED_OUT" or "ERROR: server connection failed: connection_error"</p>
<p class="startli"><b>Resolution</b>:</p>
<p class="startli">In the OWT server, the following default ports have been assigned for server usage: 5672 (configurable), 8080 (configurable), 3000 (configurable), 3300 (configurable). Make sure they are always available for OWT server. Also, in order to configure the two configurable ports above to a value smaller than the 1024 limitation, use the following command to enable it: </p><pre class="fragment">sudo setcap cap_net_bind_service=+ep $(which node)
</pre><p class="startli">If you are still not able to bypass the 1024 port limitation, remember to put the <b>OWT server library path into /etc/ld.so.conf.d</b>. </p>
</li>
</ol>
<h1><a class="anchor" id="Conferencesection3"></a>
3 OWT Server Management Console Brief Guide</h1>
<h2><a class="anchor" id="Conferencesection3_1"></a>
3.1 Introduction</h2>
<p>The OWT Server Management Console is the frontend console to manage the OWT server. It is built with OWT's server-side APIs and it provides the management interface to OWT administrators. </p>
<h2><a class="anchor" id="Conferencesection3_2"></a>
3.2 Access</h2>
<p>Once you have launched OWT servers, you can then access the console via a browser at <a href="https://XXXX:3300/console/">https://XXXX:3300/console/</a> by default. You will be asked for your the service-id and service-key in order to access the service.</p>
<p>After inputting your service-id and service-key in the dialog prompt, choose 'remember me' and click 'save changes' to save your session. If you want to switch to another service, click the ‘profile' button on the upper-right corner to get in this dialog prompt and do the similar procedure again. If you want to log out the management console, click the red ‘clear cookie' button in the dialog prompt.</p>
<p>If you have not launched OWT servers, you should launch the management-api server before accessing the management console: </p><pre class="fragment">cd Release-&lt;Version&gt;/
bin/daemon.sh start management-api
bin/daemon.sh start management-console
</pre><h2><a class="anchor" id="Conferencesection3_3"></a>
3.3 Source Code</h2>
<p>The source code of the management console is in Release-&lt;Version&gt;/management_console/public/. </p>
<h2><a class="anchor" id="Conferencesection3_4"></a>
3.4 Service Management</h2>
<p>Only super service user can access service management, in the 'overview' tab to create or delete services. The service is the instance that owns rooms and has the ability to manage them. </p><blockquote class="doxtable">
<p><b>Note</b>: Super service cannot be deleted, it can be configured in management_api/management_api.toml. </p>
</blockquote>
<h2><a class="anchor" id="Conferencesection3_5"></a>
3.5 Room Management</h2>
<p>Any service user can do room management inside the service, including creating, deleting or modifying rooms.</p>
<p>To modify rooms, a user can edit room configuration for its own preference. The the details of each configuration item for room are listed in the following table:</p>
<p><b>Table 3-1. Room Configuration</b> </p><table class="doxtable">
<tr>
<th>Item</th><th>Description  </th></tr>
<tr>
<td>name </td><td>The name of the room (name is not equal to the ID, room's ID cannot be changed once created) </td></tr>
<tr>
<td>inputLimit </td><td>The input limitation for the room, means how many publication can a room allow </td></tr>
<tr>
<td>participantLimit </td><td>The max participant number of the room </td></tr>
<tr>
<td>roles </td><td>The role definition list for the room, for the description of list element see the role.* </td></tr>
<tr>
<td>role.role </td><td>The name for a certain role </td></tr>
<tr>
<td>role.*(operation).*(mediaType) </td><td>The capability to publish/subscribe audio/video stream for a certain role </td></tr>
<tr>
<td>views </td><td>The view list for the room, each view represents a combination of mix stream settings. To disable mixing, set this to empty list </td></tr>
<tr>
<td>view.label </td><td>The label for a certain view, two view labels in one room cannot be duplicated </td></tr>
<tr>
<td>view.audio.format </td><td>The default audio format of the view selected from 'mediaOut.audio' configuration </td></tr>
<tr>
<td>view.audio.vad </td><td>The 'activeInput' event will be emitted if this option is true, note that if a client publish more than one audio stream, this may not work well </td></tr>
<tr>
<td>view.video.format </td><td>The default video format of the view selected from 'mediaOut.format.video' configuration </td></tr>
<tr>
<td>view.video.parameters.resolution </td><td>The default video resolution of the view </td></tr>
<tr>
<td>view.video.parameters.framerate </td><td>The default video framerate of the view </td></tr>
<tr>
<td>view.video.parameters.bitrate </td><td>The default video bitrate of the view, if it's not specified, the mix engine will generate a default one, see Table 3-3 for more details </td></tr>
<tr>
<td>view.video.parameters.keyFrameInterval </td><td>The default video key frame interval of the view </td></tr>
<tr>
<td>view.video.maxInput </td><td>This indicates the maximum number of video inputs for the video layout definition, input that exceed the value will not be shown in mixed stream </td></tr>
<tr>
<td>view.video.motionFactor </td><td>The video motion factor is used to affact the default bitrate of the video stream </td></tr>
<tr>
<td>view.video.bgColor </td><td>The RGB representation for background color of the mixed video stream </td></tr>
<tr>
<td>view.keepActiveInputPrimary </td><td>The active input will always be shown in the 'primary' region when this option is set to true with 'vad' also enabled </td></tr>
<tr>
<td>view.layout </td><td>The layout of mixed video stream </td></tr>
<tr>
<td>view.layout.fitPolicy </td><td>The fit policy for input that does not perfectly match the width/height ratio </td></tr>
<tr>
<td>view.layout.templates </td><td>The layout template for the mixed video stream, a user can choose a base layout template and customize its own preferred ones, which would be combined as a whole for rendering mixed video </td></tr>
<tr>
<td>view.layout.templates.base </td><td>The template base for video layout </td></tr>
<tr>
<td>view.layout.templates.custom </td><td>The customized video layout uppon the base, see the <a href="#Conferencesection3_5_1">Section 3.5.1</a> </td></tr>
<tr>
<td>mediaIn </td><td>The audio/video format that the room can accept, see the Table 3-2 for supported format </td></tr>
<tr>
<td>mediaOut </td><td>The audio/video format and parameters that the room can generate through media processing, see the Table 3-2 for supported formats </td></tr>
<tr>
<td>transcoding </td><td>The transcoding switch on audio, video format and parameters </td></tr>
<tr>
<td>sip </td><td>The SIP setting for the room </td></tr>
<tr>
<td>notifying </td><td>The notifying policy for the room </td></tr>
</table>
<p><b>Table 3-2 Supported Media Formats</b> </p><table class="doxtable">
<tr>
<th>Name</th><th>Type  </th></tr>
<tr>
<td>opus </td><td>audio </td></tr>
<tr>
<td>isac_16000 </td><td>audio </td></tr>
<tr>
<td>isac_32000 </td><td>audio </td></tr>
<tr>
<td>g722_16000_1 </td><td>audio </td></tr>
<tr>
<td>pcma </td><td>audio </td></tr>
<tr>
<td>pcmu </td><td>audio </td></tr>
<tr>
<td>aac </td><td>audio </td></tr>
<tr>
<td>ac3 </td><td>audio </td></tr>
<tr>
<td>nellymoser </td><td>audio </td></tr>
<tr>
<td>ilbc </td><td>audio </td></tr>
<tr>
<td>h264 </td><td>video </td></tr>
<tr>
<td>h265 </td><td>video </td></tr>
<tr>
<td>vp8 </td><td>video </td></tr>
<tr>
<td>vp9 </td><td>video </td></tr>
</table>
<blockquote class="doxtable">
<p><b>Note</b>: When video format is "h264", for decoding, either software or hardware version OWT server supports all profiles. For encoding, software version OWT server with openh264 supports constrained-baseline profile and hardware version supports profiles including constrained-baseline, baseline, main, high. </p>
</blockquote>
<p><b>Table 3-3 Default bitrate for typical resolutions (30fps)</b> </p><table class="doxtable">
<tr>
<th>Resolution</th><th>Default bitrate(kbps)  </th></tr>
<tr>
<td>352x288 (cif)</td><td>442 </td></tr>
<tr>
<td>176x144 (qcif)</td><td>132 </td></tr>
<tr>
<td>320x240 (sif)</td><td>400 </td></tr>
<tr>
<td>640x480 (vga)</td><td>800 </td></tr>
<tr>
<td>800x600 (svga)</td><td>1137 </td></tr>
<tr>
<td>1024x768 (xga)</td><td>1736 </td></tr>
<tr>
<td>480x320 (hvga)</td><td>533 </td></tr>
<tr>
<td>1280x720 (hd720p)</td><td>2000 </td></tr>
<tr>
<td>1920x1080 (hd1080p)</td><td>4000 </td></tr>
<tr>
<td>3840x2160 (uhd_4k)</td><td>16000 </td></tr>
</table>
<p>The actual default bitrate will be affacted by resolution, framerate, motion factor, see the Table 3-3 to get overall data. If framerate or resolution is specified in the subscription without bitrate, default bitrate is used and the view bitrate setting won't work.</p>
<blockquote class="doxtable">
<p><b>Note</b>: If base layout is set to 'void', user must input customized layout for the room, otherwise the video layout would be treated as invalid. Read 3.5.1 for details of customized layout. maxInput indicates the maximum number of video frame inputs for the video layout definition. </p>
</blockquote>
<h3><a class="anchor" id="Conferencesection3_5_1"></a>
3.5.1 Customized video layout</h3>
<p>The OWT server supports the mixed video layout configuration which is similar as RFC5707 Media Server Markup Language (MSML). A valid customized video layout should be an array of video layout definition. The following example shows the details:</p>
<p><b>Figure 3-1. Example Layout</b> </p><div class="image">
<img src="./pic/layout.jpg" alt="Example layout"/>
</div>
<div class="fragment"><div class="line">// Video layout for the case of 1 input or 6 inputs</div><div class="line">[</div><div class="line">  {</div><div class="line">    &quot;region&quot;: [</div><div class="line">      {</div><div class="line">        &quot;id&quot;: &quot;1&quot;,</div><div class="line">        &quot;shape&quot;: &quot;rectangle&quot;,</div><div class="line">        &quot;area&quot;: {</div><div class="line">            &quot;left&quot;: &quot;0&quot;,</div><div class="line">            &quot;top&quot;: &quot;0&quot;,</div><div class="line">            &quot;width&quot;: &quot;1&quot;,</div><div class="line">            &quot;height&quot;: &quot;1&quot;</div><div class="line">        }</div><div class="line">      }</div><div class="line">    ]</div><div class="line">  },</div><div class="line">  {</div><div class="line">    &quot;region&quot;: [</div><div class="line">      {</div><div class="line">        &quot;id&quot;: &quot;1&quot;,</div><div class="line">        &quot;shape&quot;: &quot;rectangle&quot;,</div><div class="line">        &quot;area&quot;: {</div><div class="line">            &quot;left&quot;: &quot;0&quot;,</div><div class="line">            &quot;top&quot;: &quot;0&quot;,</div><div class="line">            &quot;width&quot;: &quot;2/3&quot;,</div><div class="line">            &quot;height&quot;: &quot;2/3&quot;</div><div class="line">        }</div><div class="line">      },</div><div class="line">      {</div><div class="line">        &quot;id&quot;: &quot;2&quot;,</div><div class="line">        &quot;shape&quot;: &quot;rectangle&quot;,</div><div class="line">        &quot;area&quot;: {</div><div class="line">            &quot;left&quot;: &quot;2/3&quot;,</div><div class="line">            &quot;top&quot;: &quot;0&quot;,</div><div class="line">            &quot;width&quot;: &quot;1/3&quot;,</div><div class="line">            &quot;height&quot;: &quot;1/3&quot;</div><div class="line">        }</div><div class="line">      },</div><div class="line">      {</div><div class="line">        &quot;id&quot;: &quot;3&quot;,</div><div class="line">        &quot;shape&quot;: &quot;rectangle&quot;,</div><div class="line">        &quot;area&quot;: {</div><div class="line">            &quot;left&quot;: &quot;2/3&quot;,</div><div class="line">            &quot;top&quot;: &quot;1/3&quot;,</div><div class="line">            &quot;width&quot;: &quot;1/3&quot;,</div><div class="line">            &quot;height&quot;: &quot;1/3&quot;</div><div class="line">        }</div><div class="line">      },</div><div class="line">      {</div><div class="line">        &quot;id&quot;: &quot;4&quot;,</div><div class="line">        &quot;shape&quot;: &quot;rectangle&quot;,</div><div class="line">        &quot;area&quot;: {</div><div class="line">            &quot;left&quot;: &quot;2/3&quot;,</div><div class="line">            &quot;top&quot;: &quot;2/3&quot;,</div><div class="line">            &quot;width&quot;: &quot;1/3&quot;,</div><div class="line">            &quot;height&quot;: &quot;1/3&quot;</div><div class="line">        }</div><div class="line">      },</div><div class="line">      {</div><div class="line">        &quot;id&quot;: &quot;5&quot;,</div><div class="line">        &quot;shape&quot;: &quot;rectangle&quot;,</div><div class="line">        &quot;area&quot;: {</div><div class="line">            &quot;left&quot;: &quot;1/3&quot;,</div><div class="line">            &quot;top&quot;: &quot;2/3&quot;,</div><div class="line">            &quot;width&quot;: &quot;1/3&quot;,</div><div class="line">            &quot;height&quot;: &quot;1/3&quot;</div><div class="line">        }</div><div class="line">      },</div><div class="line">      {</div><div class="line">        &quot;id&quot;: &quot;6&quot;,</div><div class="line">        &quot;shape&quot;: &quot;rectangle&quot;,</div><div class="line">        &quot;area&quot;: {</div><div class="line">            &quot;left&quot;: &quot;0&quot;,</div><div class="line">            &quot;top&quot;: &quot;2/3&quot;,</div><div class="line">            &quot;width&quot;: &quot;1/3&quot;,</div><div class="line">            &quot;height&quot;: &quot;1/3&quot;</div><div class="line">        }</div><div class="line">      }</div><div class="line">    ]</div><div class="line">  }</div><div class="line">]</div></div><!-- fragment --><p> Each "region" defines video panes that are used to display participant video streams.</p>
<p>Regions are rendered on top of the root mixed stream. "id" is the identifier for each video layout region.</p>
<p>The size of a region is specified relative to the size of the root mixed stream using the "width" and "height" attributes.</p>
<p>Regions are located on the root window based on the value of the position attributes "top" and "left". These attributes define the position of the top left corner of the region as an offset from the top left corner of the root mixed stream, which is a percent of the vertical or horizontal dimension of the root mixed stream.</p>
<h3><a class="anchor" id="Conferencesection3_5_2"></a>
3.5.2 Enable SIP connectivity</h3>
<p>The OWT server supports connection from SIP clients. Before setting up SIP connectivity for rooms, make sure SIP server (like Kamailio) and related SIP user accounts are available. The SIP settings can be enabled through SDK or management console. On the console page, find the room that needs interaction with SIP clients and click the related "Room Detail" field. Then find the SIP setting fields in sub-section "sip".</p>
<p>The meaning of each field is listed below: </p><pre class="fragment">    sipServer: The SIP server's hostname or IP address.
    username: The user name registered in the above SIP server.
    password: The user's password.
</pre><p>After the SIP settings have been done, click the "Apply" button at the right side of the Room row to let it take effect. If the "Update Room Success" message shows up and the SIP related information is correct, then SIP clients should be able to join this room via the registered SIP server.</p>
<h2><a class="anchor" id="Conferencesection3_6"></a>
3.6 Cluster Worker Scheduling Policy Introduction</h2>
<p>All workers including portals, conference-agents, webrtc-agents, streaming-agents, recording-agents, audio-agents, video-agents, sip-agents in the cluster are scheduled by the cluster-manager with respect to the configured scheduling strategies in cluster_manager/cluster_manager.toml. For example, the configuration item "portal = last-used" means the scheduling policy of workers with purposes of "portal" is set to "last-used". The following built-in scheduling strategies are provided:</p><ol type="1">
<li>last-used: If more than 1 worker with the specified purpose is alive and available, the last used one will be scheduled.</li>
<li>least-used: If more than 1 worker with the specified purpose is alive and available, the one with the least work-load will be scheduled.</li>
<li>most-used: If more than 1 worker with the specified purpose is alive and available, the one with the heavist work-load will be scheduled.</li>
<li>round-robin: If more than 1 worker with the specified purpose is alive and available, they will be scheduled one by one circularly.</li>
<li>randomly-pick: If more than 1 worker with the specified purpose is alive and available, they will be scheduled randomly.</li>
</ol>
<p>For portal and webrtc-agent workers, the "isp" and "region" preferences can be specified in portal and webrtc-agent configurations. Pass the preferred "isp" and "region" when creating a token, then cluster-manager will only schedule the corresponding worker nodes to the client requests that match "isp" and "region" preferences. The portal and webrtc-agent will serve all the isp and region if corresponding configuration items under "capacity" are set to empty lists. If no preferences are specified for clients when creating token, then only those portal and webrtc-agent with empty isp and region setting will serve them.</p>
<h2><a class="anchor" id="Conferencesection3_7"></a>
3.7 Runtime Configuration</h2>
<p>Only super service user can access runtime configuration. Current management console implementation just provides the OWT server cluster runtime configuration viewer.</p>
<h1><a class="anchor" id="Conferencesection4"></a>
4 OWT Sample Application Server User Guide</h1>
<h2><a class="anchor" id="Conferencesection4_1"></a>
4.1 Introduction</h2>
<p>The OWT sample application server is a Web application demo that shows how to host audio/video conference services powered by the Open WebRTC Toolkit. The sample application server is based on OWT runtime components. Refer to <a href="#Conferencesection2">Section 2</a> of this guide, for system requirements and launch/stop instructions.</p>
<p>The source code of the sample application is in Release-&lt;Version&gt;/extras/basic_example/.</p>
<p>This section explains how to start a conference and then connect to a conference using different qualifiers, such as a specific video resolution.</p>
<h2><a class="anchor" id="Conferencesection4_2"></a>
4.2 Start a Conference through the OWT Sample Application Server</h2>
<p>These general steps show how to start a conference:</p>
<ol type="1">
<li>Start up the OWT server components.</li>
<li>Launch your Google Chrome* browser from the client machine.</li>
<li>Connect to the OWT sample application server at: <a href="https://XXXXX:3004">https://XXXXX:3004</a>. Replace XXXXX with the IP address or machine name of the OWT sample application server. <blockquote class="doxtable">
<p><b>Note</b>: Latest Chrome browser versions from v47 force https access on WebRTC applications. You will get SSL warning page with default certificates, replace them with your own trusted ones. </p>
</blockquote>
</li>
<li>Start your conference with this default room created by the sample application server.</li>
</ol>
<h3><a class="anchor" id="Conferencesection4_2_1"></a>
4.2.1 Connect to an OWT server conference with specific room</h3>
<p>You can connect to a particular conference room. To do this, simply specify your room ID via a query string in your URL: room. For example, connect to the OWT sample application server XXXXX with the following URL: </p><pre class="fragment">    https://XXXXX:3004/?room=some_particular_room_id
</pre><p> This will direct the conference connection to the room with the ID some_particular_room_id. </p>
<h3><a class="anchor" id="Conferencesection4_2_2"></a>
4.2.2 Connect to an OWT server conference to subscribe forward streams</h3>
<p>Since OWT conference room can now produce both forward streams and mixed stream at the same time, including the screen sharing stream, the client is able to subscribe specified stream(s) by a query string in your URL: forward. The default value for the key word is false.</p>
<p>For example, to subscribe forward stream instead of mixed stream from OWT server, connect to the OWT sample application server XXXXX with the following URL: </p><pre class="fragment">    https://XXXXX:3004/?forward=true
</pre><h3><a class="anchor" id="Conferencesection4_2_3"></a>
4.2.3 Connect to an OWT conference with an RTSP input</h3>
<p>The OWT conference supports external stream input from devices that support RTSP protocol, like IP Camera. For example, connect to the OWT sample application server XXXXX with the following URL: </p><pre class="fragment">    https://XXXXX:3004/?url=rtsp_stream_url
</pre><h1><a class="anchor" id="Conferencesection5"></a>
5 Peer Server</h1>
<h2><a class="anchor" id="Conferencesection5_1"></a>
5.1 Introduction</h2>
<p>The peer server is the default signaling server of the Open-WebRTC-Toolkit. The peer server provides the ability to exchange WebRTC signaling messages over Socket.IO between different clients.</p>
<p><b>Figure 5-1. Peer Server Framework</b> </p><div class="image">
<img src="./pic/framework.png" alt="Framework" style="width: 600px;"/>
</div>
<h2><a class="anchor" id="Conferencesection5_2"></a>
5.2 Installation requirements</h2>
<p>The installation requirements for the peer server are listed in Table 5-1 and 5-2.</p>
<p><b>Table 5-1. Installation requirements</b> </p><table class="doxtable">
<tr>
<th>Component name </th><th>OS version  </th></tr>
<tr>
<td>Peer server </td><td>Ubuntu 18.04 LTS, CentOS* 7.6/7.4 </td></tr>
</table>
<blockquote class="doxtable">
<p><b>Note</b>: The peer server has been fully tested on Ubuntu14.04 LTS,64-bit. </p>
</blockquote>
<p><b>Table 5-2. Peer Server Dependencies</b> </p><table class="doxtable">
<tr>
<th>Name </th><th>Version </th><th>Remarks  </th></tr>
<tr>
<td>Node.js </td><td>8.15.0 </td><td>Website: <a href="http://nodejs.org/">http://nodejs.org/</a> </td></tr>
<tr>
<td>Node modules </td><td>Specified </td><td>N/A </td></tr>
</table>
<p>Regarding Node.js*, make sure it's installed in your system prior to installing the Peer Server. We recommend version 8.15.0. Refer to <a href="http://nodejs.org/">http://nodejs.org/</a> for installation details. </p>
<h2><a class="anchor" id="Conferencesection5_3"></a>
5.3 Installation</h2>
<p>On the server machine, unpack the peer server release package, and install node modules </p><pre class="fragment">    tar –zxvf CS_WebRTC_Conference_Server_Peer.v&lt;Version&gt;.tgz
    cd PeerServer-Release-&lt;Version&gt;
    npm install
</pre><p>The default http port is 8095, and the default secured port is 8096. Those default values can be modified in the file config.json. </p>
<h2><a class="anchor" id="Conferencesection5_4"></a>
5.4 Use your own certificate</h2>
<p>If you want to use a secured socket.io connection, you should use your own certificate for the service. A default certificate is stored in cert with two files: cert.pem and key.pem. Replace these files with your own certificate and key files. </p>
<h2><a class="anchor" id="Conferencesection5_5"></a>
5.5 Launch the peer server</h2>
<p>Run the following commands to launch the peer server: </p><pre class="fragment">    cd PeerServer-Release-&lt;Version&gt;
    node peerserver.js
</pre><h2><a class="anchor" id="Conferencesection5_6"></a>
5.6 Stop the peer server</h2>
<p>Run the <b>kill</b> command directly from the terminal to stop the peer server.</p>
<h1><a class="anchor" id="Conferencesection6"></a>
6 Appendix</h1>
<h2><a class="anchor" id="Conferencesection6_1"></a>
6.1 Media Analytics in OWT Server</h2>
<h3><a class="anchor" id="Conferencesection6_1_1"></a>
6.1.1 Introduction</h3>
<p>OWT server provides media analytics functionality via REST API. The media analytics plugins allows you performing analytics on any stream in OWT server, generating new streams and/or emitting events during analytics. The proposed usage scenario for real-time media analytics includes but is not limited to movement/object detection in surveillance and remote health care, customer/audience analyzing in retail and remote education, etc.</p>
<p>For usage of media analytics REST API, refer to the REST API document.</p>
<h3><a class="anchor" id="Conferencesection6_1_2"></a>
6.1.2 Building Existing Plugins</h3>
<p>A few sample plugins are shipped with OWT server. After you build and install OWT server, the source of those analytics plugins will be placed under analytics_agent/plugins/ directory.</p>
<p>Before you build those plugins, you need to install Intel Distribution of OpenVINO 2018 R5 from <a href="https://software.intel.com/en-us/openvino-toolkit/">https://software.intel.com/en-us/openvino-toolkit/</a>. After installation, make sure you go to /opt/intel/computer_vision_sdk/install_dependencies/ directory, and run: sudo -E ./install_NEO_OCL_driver.sh</p>
<p>Intel Distribution of OpenVINO 2018 R5 will require Intel Core 6th to 8th Generation with Intel HD graphics or Iris(Pro) graphics for inferencing on GPU with OpenCL as the backend. The supported OSes are Ubuntu 16.04 and higher, or CentOS 7.4 or higher. Make sure your hardware/software configuration is correct before building and deploying the sample plugins.</p>
<p>To build the plugins, simply go to analytics_agent/plugins/sample directory, and run: ./build_samples.sh</p>
<p>Copy all files under build/intel64/Release/lib/ to analytics_agent/lib/ directory, or to the libpath as specified in agent.toml in analytics_agent.</p>
<h3><a class="anchor" id="Conferencesection6_1_3"></a>
6.1.3 Using Pre-built Plugins</h3>
<p>The Server provides 4 plugins as source code which can be built by your own. To verify them, make sure you run <code>source /opt/intel/computer_vision_sdk/bin/setupvars.sh</code> before starting up OWT server.</p>
<h4><a class="anchor" id="Conferencesection6_1_3_1"></a>
6.1.3.1 Face Detection Plugin</h4>
<p>Identified by GUID b849f44bee074b08bf3e627f3fc927c7. This plugin provides the capability of finding faces in current analyzed stream and annotates it with a rectangle boarder on the face. </p>
<h4><a class="anchor" id="Conferencesection6_1_3_2"></a>
6.1.3.2 Face Recognition Plugin</h4>
<p>Identified by GUID 3f932ff2a80341faa0a73ebb3bcfb85d. This plugin provides the capability of identifying people's name in current stream and annotates them with a rectangle on the face, and also list the name and the confidence of the recognition result. To add new people for recognition, here are the steps:</p><ol type="1">
<li>Take at least 3 pictures of one person and place them under the raw_photos directory with sub-directory name that identifies that person's name(no space in the directory name). The raw_photos should be under the same directory with the pre-process tool.</li>
<li>Run the pre-process tool to process the raw photos (which is also built when you build the samples). Append the path of libcpu_extension.so you built to LD_LIBRARY_PATH before you run the tool. Put the output vectors.txt under analytics_agent direcotry of OWT server. </li>
</ol>
<h4><a class="anchor" id="Conferencesection6_1_3_3"></a>
6.1.3.3 Smart Class Room Plugin</h4>
<p>Identified by GUID 10c213f3d55249718d3bd44712488502. This plugin provides the capability of recognizing the gestures in the stream and annotates the gestures accordingly. </p>
<h4><a class="anchor" id="Conferencesection6_1_3_4"></a>
6.1.3.4 Dummy Plugin</h4>
<p>Identified by GUID dc51138a8284436f873418a21ba8cfa7. This plugin simply modifies part of the stream to demonstrate the working process of plugins.</p>
<h3><a class="anchor" id="Conferencesection6_1_4"></a>
6.1.4 Create and Deploy Your Own Media Analytics Plugin</h3>
<p>OWT server allows you creating your own media analytics plugins and deploy them to OWT server. Refer to the analytics_agent/plugins/include/plugin.h for more detailed API interface that each media analytics plugin needs to implement.</p>
<h4><a class="anchor" id="Conferencesection6_1_4_1"></a>
6.1.4.1 Create Plugin</h4>
<p>Your plugin class implementation must inherit from rvaPlugin interface as defined in analytics_agent/plugins/include/plugin.h. Besides the plugin class implementation, it is required to include the DECLARE_PLUGIN(ClassName) macro to export your plugin implementation. </p>
<h4><a class="anchor" id="Conferencesection6_1_4_2"></a>
6.1.4.2 Deploy Your Plugin</h4>
<p>To deploy a plugin to OWT Server, you will need to generate a new GUID for your plugin. After that, copy your plugin .so files to analytics_agent/lib, or to the libpath as specified by agent.toml of analtyics agent. Also you need to add an entry into the plugin.cfg file under analytics_agent with the GUID you generated, for example: [c842f499aa093c27cf1e328f2fc987c7] description = 'my own plugin' pluginversion = 1 apiversion =400 name = 'libsomeplugin.so' # full name of the plugin library libpath = 'pluginlibs/' # relative to analytics_agent directory configpath = 'pluginlibs/' # relative to analytics agent directory messaging = true # set to false if your plugin does not send notification inputfourcc = 'I420' # must be I420 for current version outputfourcc = 'I420' # set to "" if your plugin will not republish analyzed stream to OWT server.</p>
<p>Restart analytics agent and your plugin will be added to OWT server. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Mar 2 2020 15:59:37 for Intel&reg; Collaboration Suite for WebRTC version&nbsp;4.3</li>
  </ul>
</div>
</body>
<script type="text/javascript">
/*  // configure analytics
  var wapLocalCode = 'us-en'; // dynamically set per localized site
  // load analytics
  (function(){
    var host = (window.document.location.protocol == 'http:')?"http://www.intel.com":"https://www-ssl.intel.com";
    var url = host + "/content/dam/www/global/wap/wap-ssg-intel.js"; // wap file url
    var po = document.createElement('script');
    po.type = 'text/javascript';
    po.async = true;
    po.src = url;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(po, s);
  })();*/
</script>
</html>
